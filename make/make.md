# make file notes (基于跟我一起写makefile)

链接时，主要链接的是函数和全局变量，而链接所依赖的是中间目标文件。在大多数情况下，由于源文件太多，编译器需要显式的指出中间文件名，这对于编译很不方便，所以大多数时候，我们需要给中间目标文件打个包，这些包的名称为.a文件。

prerequisites中有一个及以上的文件比target要新的话，命令就会被执行.

make是如何工作的, make会一层一层地寻找依赖关系，直到编译完成第一个目标文件:
1. make会在当前目录下寻找名为Makefile或者makefile的文件
2. 如果找到，它会找文件中的第一个目标文件。
3. 如果第一个目标文件不存在，或者该目标文件所依赖的文件有一个比该目标文件新，就执行后面的命令来生成目标文件
4. 如果第一个目标文件所依赖的文件也不存在，那么make就会在当前文件中查找该依赖文件的依赖性，如果找到，则根据那个规则再生成一个依赖文件。


make的自动推导
make只要看到一个.o文件，就会自动将.c文件加到依赖关系中，比如一个try.o会被自动依赖到try.c文件

```make
.PHONY : clean
    -rm -o $(BIN)
```
表示clean是一个伪目标, 而在rm前加了一个'-'表示也许某些文件出现了问题，但也不用管，只要处理之后的事情。
.PHONY的作用是显示地指明一个目标是伪目标，即不管后面的文件（本例中为clean)是否有，这个目标就是伪目标.

makefile中有什么：
1. 显示规则：表示如何生成一个或多个可执行文件
2. 隐晦规则：make有自动推导的机制，所以可以利用隐晦规则来编写较为简短的makefile
3. 变量定义
4. 文件指示：包括三个部分，1）在一个makefile中引用另一个makefile, 2)根据某些情况定义makefile中的有效部分， 3）定义一个多行的命令。
5. 注释，使用#来进行注释, 若在makefile中使用#, 可以使用转义符\\#

在一个makefile中引用其余的makefile
可以使用include在一个makefile中引用其余的makefile；例如，有一个名为foo.mk的makefile, 引用可以使用include foo.mk


makefile中的通配符
makefile中可以使用的通配符有三个, \*, ?和~。 
\* ： 如果想要定义所有的中间目标文件，可以使用BIN=$(wildcard \*.o), 而不能直接使用BIN=\*.o，这个符号表示BIN是一个名为\*.o的文件。

文件搜寻
我们可以通过VPATH特殊变量来定义make的文件搜寻路径，如VPATH=src:../head, 定义了两个文件搜寻路径src和../head(当前目录永远是最高优先搜索的地方)
另外一个设置文件搜索路径是通过vpath关键字，相对于VPATH， 这种方法设置更加灵活。
命令格式为vpath \<pattern\> \<directories\>
vpath中的\<pattern\>中需要包含%字符， 其可以匹配零或者若干个字符， 例如%.h表示所有的以.h结尾的文件
